---====== Services ======---

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

---====== Load spawner ======---

local spawner = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Entity%20Spawner/V2/Source.lua"
))()

---====== Create entity ======---

local entity = spawner.Create({
	Entity = {
		Name = "Whisper",
		Asset = "rbxassetid://12789806614",
		HeightOffset = 0
	},
	Lights = {
		Flicker = {
			Enabled = false,
			Duration = 3
		},
		Shatter = true,
		Repair = false
	},
	Earthquake = { Enabled = false },
	CameraShake = {
		Enabled = true,
		Range = 100,
		Values = {3, 3, 4, 4}
	},
	Movement = {
		Speed = 50,
		Delay = 0,
		Reversed = false
	},
	Rebounding = { Enabled = false },
	Damage = { Enabled = false },
	Crucifixion = { Enabled = false },
	Death = {
		Type = "Guiding",
		Hints = {
			"You died to an entity called Whisper",
			"When it appears, don't move.",
			"If you move, this is how you end up."
		},
		Cause = "Whisper"
	}
})

---====== OnSpawned ======---

entity:SetCallback("OnSpawned", function()
	print("Entity has spawned")
function GitAud(soundgit,filename)
    SoundName=tostring(SoundName)
    local url=soundgit
    local FileName = filename
    writefile(FileName..".mp3", game:HttpGet(url))
    return (getcustomasset or getsynasset)(FileName..".mp3")
end

function CustomGitSound(soundlink, vol, filename)
    local sound = Instance.new("Sound")
    sound.SoundId = GitAud(soundlink, filename)
    sound.Parent = workspace
    sound.Volume = 1
    sound.PlaybackSpeed = 1
    sound.Name = "Whispering"
   sound:Play()
end

CustomGitSound("https://github.com/Guestly-V2-2/Music-Sound/raw/refs/heads/main/XRecorder_Edited_20260111_02.mp3?raw=true", 1, " Whispering")

	local caption = player.PlayerGui.MainUI.MainFrame.Caption
	caption.TextColor3 = Color3.fromRGB(255, 222, 189)

	require(player.PlayerGui.MainUI.Initiator.Main_Game)
		.caption("Do Not Move", true)

	-- GIỮ NGUYÊN
	workspace.Whisper.RushNew.Attachment.PointLight.Color = Color3.fromRGB(255,255,255)
	workspace.Whisper.RushNew.Footsteps.Playing = false
	workspace.Whisper.RushNew.PlaySound.Playing = false
	workspace.Whisper.RushNew.Attachment.BlackTrail:Destroy()
	workspace.Whisper.RushNew.Attachment.ParticleEmitter.Texture = "rbxassetid://117047822744197"
	workspace.Whisper.RushNew.Attachment.PointLight.Brightness = 3
	workspace.Whisper.RushNew.Attachment.PointLight.Range = 12
	workspace.Whisper.RushNew.Attachment.PointLight.Enabled = true
wait(11)
game.Workspace.Whispering:Destroy()
end)

---====== Kill if moving ======---

entity:SetCallback("OnEnterRoom", function(room, firstTime)
	if not firstTime then return end

	local character = player.Character or player.CharacterAdded:Wait()
	local humanoid = character:WaitForChild("Humanoid")

	local active = true

	coroutine.wrap(function()
		while active do
			if humanoid.MoveDirection.Magnitude > 0 then
				humanoid.Health = 0

				-- ✅ firesignal ĐÚNG CÁCH (Doors)
				if firesignal and ReplicatedStorage:FindFirstChild("RemotesFolder") then
					local remote = ReplicatedStorage.RemotesFolder:FindFirstChild("DeathHint")
					if remote then
						firesignal(
							remote.OnClientEvent,
							{
								"You died to an entity called Whisper",
								"When it appears, you must stop moving",
								"Otherwise, this is how you end up."
							},
							"Blue"
						)
					end
				end

				local stats = ReplicatedStorage.GameStats:FindFirstChild("Player_" .. player.Name)
				if stats then
					stats.Total.DeathCause.Value = "Whisper"
				end

				break
			end
			task.wait()
		end
	end)()

	task.delay(2.5, function()
		active = false
	end)
end)

---====== Run ======---

entity:Run()
